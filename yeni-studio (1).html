<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#1a0a1e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Yeni Studio">
<title>Yeni Studio ‚Äî Cosmetolog√≠a</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,600;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
:root{
  --bg:#0f0a17;--sidebar:#160d20;--surface:#1e1230;--surface2:#261840;
  --border:#2e1f45;--accent:#c084fc;--accent2:#e879f9;--pink:#f472b6;
  --green:#34d399;--yellow:#fbbf24;--red:#f87171;--text:#f0e8ff;--muted:#8b6aaa;
}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;}

/* SETUP */
#setup{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px;background:var(--bg);}
.setup-card{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:40px 36px;width:100%;max-width:460px;box-shadow:0 20px 60px rgba(0,0,0,.5);}
.setup-logo{text-align:center;margin-bottom:6px;font-family:'Playfair Display',serif;font-size:1.9rem;background:linear-gradient(135deg,var(--accent),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.setup-tagline{text-align:center;color:var(--muted);font-size:.85rem;margin-bottom:28px;}
.setup-steps{display:flex;flex-direction:column;gap:14px;margin-bottom:24px;}
.setup-step-row{display:flex;gap:12px;align-items:flex-start;}
.step-bubble{width:26px;height:26px;border-radius:50%;flex-shrink:0;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700;color:white;margin-top:1px;}
.step-text{font-size:.84rem;color:var(--muted);line-height:1.6;}
.step-text b{color:var(--text);}
.step-text a{color:var(--accent);text-decoration:none;}
.code-toggle{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:transparent;color:var(--accent);font-size:.82rem;cursor:pointer;margin-bottom:12px;font-family:'Inter',sans-serif;transition:all .2s;}
.code-toggle:hover{background:rgba(192,132,252,.08);}
#code-block{display:none;background:#09060f;border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:14px;font-family:monospace;font-size:.71rem;color:#c084fc;overflow-x:auto;white-space:pre-wrap;word-break:break-all;max-height:150px;overflow-y:auto;}
#setup-error{display:none;background:rgba(248,113,113,.1);border:1px solid rgba(248,113,113,.3);border-radius:10px;padding:10px 14px;font-size:.82rem;color:var(--red);margin-bottom:12px;}
.setup-label{display:block;font-size:.73rem;text-transform:uppercase;letter-spacing:.08em;color:var(--muted);margin-bottom:6px;}
.setup-inp{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:12px 15px;color:var(--text);font-size:.88rem;outline:none;transition:border-color .2s;margin-bottom:12px;font-family:'Inter',sans-serif;}
.setup-inp:focus{border-color:var(--accent);}
.setup-inp::placeholder{color:var(--muted);}
.btn-connect{width:100%;padding:13px;border:none;border-radius:12px;cursor:pointer;background:linear-gradient(135deg,var(--accent),var(--pink));color:white;font-size:.95rem;font-weight:600;transition:all .2s;font-family:'Inter',sans-serif;}
.btn-connect:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(192,132,252,.35);}
.btn-connect:disabled{opacity:.6;cursor:not-allowed;transform:none;}

/* APP */
#app{display:none;}
.layout{display:flex;min-height:100vh;}

/* SIDEBAR */
.sidebar{width:235px;flex-shrink:0;background:var(--sidebar);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;top:0;left:0;height:100vh;z-index:100;transition:transform .3s;}
.sidebar-logo{padding:20px 18px 16px;border-bottom:1px solid var(--border);}
.logo-main{font-family:'Playfair Display',serif;font-size:1.25rem;background:linear-gradient(135deg,var(--accent),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.logo-sub{font-size:.7rem;color:var(--muted);margin-top:2px;}
.conn-dot{width:7px;height:7px;border-radius:50%;background:var(--green);display:inline-block;animation:pulse 2s infinite;margin-right:4px;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.sidebar-nav{flex:1;padding:12px 8px;overflow-y:auto;}
.nav-label{font-size:.63rem;text-transform:uppercase;letter-spacing:.1em;color:var(--muted);padding:8px 10px 4px;}
.nav-item{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:10px;cursor:pointer;font-size:.84rem;color:var(--muted);transition:all .15s;border:none;background:none;width:100%;text-align:left;font-family:'Inter',sans-serif;}
.nav-item:hover{background:var(--surface);color:var(--text);}
.nav-item.active{background:linear-gradient(135deg,rgba(192,132,252,.18),rgba(232,121,249,.08));color:var(--accent);border:1px solid rgba(192,132,252,.18);}
.ni{font-size:1rem;width:20px;text-align:center;}
.nalert{margin-left:auto;background:var(--red);color:white;font-size:.63rem;font-weight:700;padding:1px 6px;border-radius:10px;}
.sidebar-foot{padding:12px;border-top:1px solid var(--border);}
.btn-gs{display:flex;align-items:center;gap:8px;padding:9px 12px;border-radius:9px;background:rgba(52,211,153,.08);border:1px solid rgba(52,211,153,.2);color:var(--green);font-size:.77rem;text-decoration:none;margin-bottom:7px;transition:background .2s;}
.btn-gs:hover{background:rgba(52,211,153,.16);}
.btn-rcfg{display:flex;align-items:center;gap:8px;padding:9px 12px;border-radius:9px;background:transparent;border:1px solid var(--border);color:var(--muted);font-size:.77rem;cursor:pointer;width:100%;font-family:'Inter',sans-serif;transition:all .2s;}
.btn-rcfg:hover{color:var(--text);border-color:var(--muted);}

/* MAIN */
.main{margin-left:235px;flex:1;display:flex;flex-direction:column;}
.topbar{background:rgba(15,10,23,.92);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:0 22px;height:56px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;}
.topbar-l{display:flex;align-items:center;gap:10px;}
.hamburger{display:none;background:none;border:none;cursor:pointer;color:var(--muted);font-size:1.2rem;padding:4px;}
.topbar-title{font-size:.95rem;font-weight:600;}
.topbar-r{display:flex;align-items:center;gap:8px;}
.sync-lbl{font-size:.73rem;color:var(--muted);}
.btn-sync{display:flex;align-items:center;gap:6px;padding:6px 13px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--muted);font-size:.77rem;cursor:pointer;font-family:'Inter',sans-serif;transition:all .2s;}
.btn-sync:hover{color:var(--text);border-color:var(--accent);}
.spinning .sr{animation:spin .6s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}
.sr{display:inline-block;}

/* CONTENT */
.content{padding:22px;flex:1;}
.page{display:none;}
.page.active{display:block;}

/* STATS */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:22px;}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px 18px;}
.stat-icon{font-size:1.4rem;margin-bottom:6px;}
.stat-val{font-family:'Playfair Display',serif;font-size:1.8rem;color:var(--accent);line-height:1;}
.stat-lbl{font-size:.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:.07em;margin-top:4px;}

/* SECTION */
.sec-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px;}
.sec-title{font-size:1.05rem;font-weight:600;}
.sec-title em{font-family:'Playfair Display',serif;font-style:italic;color:var(--accent);}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:6px;padding:7px 16px;border-radius:8px;border:none;cursor:pointer;font-family:'Inter',sans-serif;font-size:.8rem;font-weight:500;transition:all .2s;}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--pink));color:white;}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 5px 16px rgba(192,132,252,.3);}
.btn-ghost{background:transparent;color:var(--muted);border:1px solid var(--border);}
.btn-ghost:hover{color:var(--text);border-color:var(--accent);}
.btn-sm{padding:4px 10px;font-size:.74rem;border-radius:6px;}
.btn-danger{background:rgba(248,113,113,.1);color:var(--red);border:1px solid rgba(248,113,113,.22);}
.btn-success{background:rgba(52,211,153,.1);color:var(--green);border:1px solid rgba(52,211,153,.22);}
.btn-warn{background:rgba(251,191,36,.1);color:var(--yellow);border:1px solid rgba(251,191,36,.22);}

/* SEARCH */
.search-bar{display:flex;align-items:center;gap:8px;background:var(--surface);border:1px solid var(--border);border-radius:9px;padding:8px 12px;margin-bottom:12px;}
.search-bar input{background:transparent;border:none;outline:none;color:var(--text);font-family:'Inter',sans-serif;font-size:.83rem;flex:1;}
.search-bar input::placeholder{color:var(--muted);}

/* CHIPS */
.chips{display:flex;gap:7px;margin-bottom:14px;flex-wrap:wrap;}
.chip{padding:4px 13px;border-radius:20px;border:1px solid var(--border);background:transparent;color:var(--muted);font-family:'Inter',sans-serif;font-size:.75rem;cursor:pointer;transition:all .2s;}
.chip.active{background:var(--surface2);color:var(--text);border-color:var(--accent);}

/* TABLE */
.tw{background:var(--surface);border:1px solid var(--border);border-radius:14px;overflow:hidden;overflow-x:auto;}
table{width:100%;border-collapse:collapse;font-size:.81rem;}
thead th{background:var(--surface2);padding:10px 13px;text-align:left;font-size:.69rem;text-transform:uppercase;letter-spacing:.07em;color:var(--muted);font-weight:500;white-space:nowrap;}
tbody td{padding:10px 13px;border-top:1px solid var(--border);vertical-align:middle;}
tbody tr:hover td{background:rgba(192,132,252,.03);}
.tda{display:flex;gap:5px;white-space:nowrap;}
.er td{text-align:center;padding:36px;color:var(--muted);font-size:.83rem;}

/* BADGES */
.badge{display:inline-block;padding:2px 8px;border-radius:20px;font-size:.67rem;font-weight:600;text-transform:uppercase;letter-spacing:.04em;white-space:nowrap;}
.b-pend{background:rgba(251,191,36,.12);color:var(--yellow);border:1px solid rgba(251,191,36,.25);}
.b-conf{background:rgba(52,211,153,.12);color:var(--green);border:1px solid rgba(52,211,153,.25);}
.b-done{background:rgba(139,110,170,.1);color:var(--muted);border:1px solid rgba(139,110,170,.2);}
.b-canc{background:rgba(248,113,113,.12);color:var(--red);border:1px solid rgba(248,113,113,.25);}

/* ALERT BANNER */
#alert-banner{background:linear-gradient(135deg,rgba(251,191,36,.07),rgba(232,121,249,.05));border:1px solid rgba(251,191,36,.22);border-radius:12px;padding:13px 16px;margin-bottom:18px;display:none;}
.ab-title{font-size:.73rem;text-transform:uppercase;letter-spacing:.08em;color:var(--yellow);margin-bottom:7px;font-weight:600;}
.ab-row{display:flex;align-items:center;gap:8px;font-size:.82rem;padding:5px 0;border-bottom:1px solid rgba(251,191,36,.1);}
.ab-row:last-child{border:none;}

/* MODAL */
.mo{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.72);backdrop-filter:blur(5px);display:none;align-items:center;justify-content:center;padding:20px;}
.mo.open{display:flex;}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:18px;padding:26px;width:100%;max-width:490px;max-height:90vh;overflow-y:auto;animation:mIn .2s ease;}
@keyframes mIn{from{opacity:0;transform:scale(.96)}to{opacity:1;transform:scale(1)}}
.modal-title{font-size:1.05rem;font-weight:600;margin-bottom:18px;}
.fg2{display:grid;grid-template-columns:1fr 1fr;gap:11px;margin-bottom:11px;}
.fg2.full{grid-template-columns:1fr;}
.fg{display:flex;flex-direction:column;gap:4px;}
.fg label{font-size:.69rem;text-transform:uppercase;letter-spacing:.07em;color:var(--muted);}
.fg input,.fg select,.fg textarea{background:var(--surface2);border:1px solid var(--border);border-radius:9px;padding:9px 11px;color:var(--text);font-family:'Inter',sans-serif;font-size:.83rem;outline:none;transition:border-color .2s;}
.fg input:focus,.fg select:focus,.fg textarea:focus{border-color:var(--accent);}
.fg select option{background:#1e1230;}
.fg textarea{resize:vertical;min-height:65px;}
.modal-actions{display:flex;justify-content:flex-end;gap:9px;margin-top:16px;}

/* TOAST */
#toast{position:fixed;bottom:18px;right:18px;z-index:999;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:9px 16px;font-size:.8rem;opacity:0;transform:translateY(8px);pointer-events:none;transition:all .25s;max-width:280px;}
#toast.show{opacity:1;transform:translateY(0);}

/* OVERLAY MOBILE */
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:99;}

/* RESPONSIVE */
@media(max-width:768px){
  .sidebar{transform:translateX(-100%);}
  .sidebar.open{transform:translateX(0);}
  .sidebar-overlay.open{display:block;}
  .main{margin-left:0;}
  .hamburger{display:flex;}
  .stats-grid{grid-template-columns:1fr 1fr;}
  .content{padding:14px;}
  .topbar{padding:0 14px;}
  .fg2{grid-template-columns:1fr;}
}
@media(max-width:480px){.stats-grid{grid-template-columns:1fr 1fr;}}
::-webkit-scrollbar{width:5px;height:5px;}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}
</style>
</head>
<body>

<!-- SETUP -->
<div id="setup">
  <div class="setup-card">
    <div class="setup-logo">‚ú¶ Yeni Studio</div>
    <div class="setup-tagline">Conecta con Google Sheets para guardar tus datos en la nube en tiempo real.</div>

    <div class="setup-steps">
      <div class="setup-step-row">
        <div class="step-bubble">1</div>
        <div class="step-text">Ve a <a href="https://sheets.new" target="_blank"><b>sheets.new</b></a> y crea una hoja llamada <b>Yeni Studio</b></div>
      </div>
      <div class="setup-step-row">
        <div class="step-bubble">2</div>
        <div class="step-text">En la hoja ve a <b>Extensiones ‚Üí Apps Script</b>, borra todo y pega el c√≥digo de abajo üëá</div>
      </div>
      <div class="setup-step-row">
        <div class="step-bubble">3</div>
        <div class="step-text">Haz clic en <b>Implementar ‚Üí Nueva implementaci√≥n ‚Üí Aplicaci√≥n web</b>. Acceso: <b>Cualquier usuario</b>. Autoriza y copia la URL.</div>
      </div>
      <div class="setup-step-row">
        <div class="step-bubble">4</div>
        <div class="step-text">Pega la URL de implementaci√≥n abajo y haz clic en <b>Conectar</b>.</div>
      </div>
    </div>

    <button class="code-toggle" onclick="toggleCode()">üìã Ver / copiar c√≥digo para Apps Script</button>
    <div id="code-block"></div>

    <div id="setup-error">‚ùå No se pudo conectar. Verifica la URL e intenta de nuevo.</div>

    <label class="setup-label">URL de implementaci√≥n de Google Apps Script</label>
    <input class="setup-inp" id="api-url" placeholder="https://script.google.com/macros/s/.../exec">

    <button class="btn-connect" id="btn-connect" onclick="conectar()">üîó Conectar con Google Sheets</button>
  </div>
</div>

<!-- APP -->
<div id="app">
  <div class="sidebar-overlay" id="overlay" onclick="closeSidebar()"></div>
  <div class="layout">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-logo">
        <div class="logo-main">‚ú¶ Yeni Studio</div>
        <div class="logo-sub">Sistema de Cosmetolog√≠a</div>
        <div style="margin-top:8px;font-size:.72rem;"><span class="conn-dot"></span><span style="color:var(--green)">Conectado</span></div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-label">Principal</div>
        <button class="nav-item active" onclick="goPage('dashboard',this)"><span class="ni">üìä</span> Dashboard</button>
        <div class="nav-label" style="margin-top:6px;">Gesti√≥n</div>
        <button class="nav-item" onclick="goPage('citas',this)"><span class="ni">üìÖ</span> Citas</button>
        <button class="nav-item" onclick="goPage('trabajos',this)"><span class="ni">üíÖ</span> Trabajos</button>
        <button class="nav-item" onclick="goPage('clientes',this)"><span class="ni">üë©</span> Clientes</button>
        <button class="nav-item" onclick="goPage('alertas',this)">
          <span class="ni">üîî</span> Alertas
          <span class="nalert" id="badge-n" style="display:none">0</span>
        </button>
      </nav>
      <div class="sidebar-foot">
        <a id="gs-link" href="https://docs.google.com/spreadsheets/d/1VCZRmvF_QCZQAD_AL79TkLVYE1Zu0bIjbRpUjH2mwec/edit" target="_blank" class="btn-gs">üìä Ver Google Sheet</a>
        <button class="btn-rcfg" onclick="reconfig()">‚öô Cambiar configuraci√≥n</button>
      </div>
    </aside>

    <div class="main">
      <header class="topbar">
        <div class="topbar-l">
          <button class="hamburger" onclick="toggleSidebar()">‚ò∞</button>
          <div class="topbar-title" id="page-title">Dashboard</div>
        </div>
        <div class="topbar-r">
          <span class="sync-lbl" id="sync-lbl"></span>
          <button class="btn-sync" id="btn-sync" onclick="syncAll()"><span class="sr">üîÑ</span> Sincronizar</button>
        </div>
      </header>

      <div class="content">

        <!-- DASHBOARD -->
        <div class="page active" id="page-dashboard">
          <div id="alert-banner">
            <div class="ab-title">üîî Citas para ma√±ana</div>
            <div id="ab-list"></div>
          </div>
          <div class="stats-grid">
            <div class="stat-card"><div class="stat-icon">üìÖ</div><div class="stat-val" id="s-hoy">‚Äî</div><div class="stat-lbl">Citas Hoy</div></div>
            <div class="stat-card"><div class="stat-icon">üë©</div><div class="stat-val" id="s-cl">‚Äî</div><div class="stat-lbl">Clientes</div></div>
            <div class="stat-card"><div class="stat-icon">üíÖ</div><div class="stat-val" id="s-tr">‚Äî</div><div class="stat-lbl">Trabajos</div></div>
            <div class="stat-card"><div class="stat-icon">üí∞</div><div class="stat-val" id="s-ing">‚Äî</div><div class="stat-lbl">Ingresos Mes</div></div>
          </div>
          <div class="sec-head"><div class="sec-title">Citas de <em>Hoy</em></div></div>
          <div class="tw"><table><thead><tr><th>Cliente</th><th>Servicio</th><th>Hora</th><th>Estado</th></tr></thead><tbody id="t-hoy"></tbody></table></div>
        </div>

        <!-- CITAS -->
        <div class="page" id="page-citas">
          <div class="sec-head">
            <div class="sec-title">Gesti√≥n de <em>Citas</em></div>
            <button class="btn btn-primary" onclick="openModal('m-cita')">+ Nueva Cita</button>
          </div>
          <div class="chips">
            <button class="chip active" onclick="fCita('todas',this)">Todas</button>
            <button class="chip" onclick="fCita('pendiente',this)">Pendientes</button>
            <button class="chip" onclick="fCita('confirmada',this)">Confirmadas</button>
            <button class="chip" onclick="fCita('completada',this)">Completadas</button>
            <button class="chip" onclick="fCita('cancelada',this)">Canceladas</button>
          </div>
          <div class="tw"><table><thead><tr><th>Cliente</th><th>Servicio</th><th>Fecha</th><th>Hora</th><th>Estado</th><th>Notas</th><th>Acciones</th></tr></thead><tbody id="t-citas"></tbody></table></div>
        </div>

        <!-- TRABAJOS -->
        <div class="page" id="page-trabajos">
          <div class="sec-head">
            <div class="sec-title">Registro de <em>Trabajos</em></div>
            <button class="btn btn-primary" onclick="openModal('m-trabajo')">+ Registrar Trabajo</button>
          </div>
          <div class="tw"><table><thead><tr><th>Cliente</th><th>Servicio</th><th>Fecha</th><th>Precio</th><th>Productos</th><th>Observaciones</th><th>Acciones</th></tr></thead><tbody id="t-trabajos"></tbody></table></div>
        </div>

        <!-- CLIENTES -->
        <div class="page" id="page-clientes">
          <div class="sec-head">
            <div class="sec-title">Base de <em>Clientes</em></div>
            <button class="btn btn-primary" onclick="openModal('m-cliente')">+ Nueva Cliente</button>
          </div>
          <div class="search-bar"><span style="color:var(--muted)">üîç</span><input type="text" id="s-cl-q" placeholder="Buscar por nombre o tel√©fono‚Ä¶" oninput="renderClientes()"></div>
          <div class="tw"><table><thead><tr><th>Nombre</th><th>Tel√©fono</th><th>Servicio Favorito</th><th>Citas</th><th>Notas</th><th>Acciones</th></tr></thead><tbody id="t-clientes"></tbody></table></div>
        </div>

        <!-- ALERTAS -->
        <div class="page" id="page-alertas">
          <div class="sec-head"><div class="sec-title">Centro de <em>Alertas</em></div></div>
          <div class="tw"><table><thead><tr><th></th><th>Cliente</th><th>Servicio</th><th>Fecha</th><th>Hora</th><th>Estado</th></tr></thead><tbody id="t-alertas"></tbody></table></div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- MODAL CITA -->
<div class="mo" id="m-cita">
  <div class="modal">
    <div class="modal-title" id="mt-cita">üìÖ Nueva Cita</div>
    <input type="hidden" id="c-eid">
    <div class="fg2">
      <div class="fg"><label>Cliente *</label><select id="c-cl"></select></div>
      <div class="fg"><label>Servicio *</label><select id="c-sv"><option value="">Seleccionar‚Ä¶</option><option>Corte de cabello</option><option>Tinte / coloraci√≥n</option><option>Peinado</option><option>Tratamiento capilar</option><option>Manicure</option><option>Pedicure</option><option>Cejas y pesta√±as</option><option>Maquillaje</option><option>Alisado</option><option>Otro</option></select></div>
    </div>
    <div class="fg2">
      <div class="fg"><label>Fecha *</label><input type="date" id="c-fe"></div>
      <div class="fg"><label>Hora *</label><input type="time" id="c-ho"></div>
    </div>
    <div class="fg2">
      <div class="fg"><label>Estado</label><select id="c-es"><option value="pendiente">Pendiente</option><option value="confirmada">Confirmada</option><option value="completada">Completada</option><option value="cancelada">Cancelada</option></select></div>
      <div class="fg"><label>Notas</label><input type="text" id="c-no" placeholder="Opcional‚Ä¶"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('m-cita')">Cancelar</button>
      <button class="btn btn-primary" id="btn-sc">üíæ Guardar</button>
    </div>
  </div>
</div>

<!-- MODAL TRABAJO -->
<div class="mo" id="m-trabajo">
  <div class="modal">
    <div class="modal-title" id="mt-tr">üíÖ Registrar Trabajo</div>
    <input type="hidden" id="t-eid">
    <div class="fg2">
      <div class="fg"><label>Cliente *</label><select id="t-cl"></select></div>
      <div class="fg"><label>Servicio *</label><select id="t-sv"><option value="">Seleccionar‚Ä¶</option><option>Corte de cabello</option><option>Tinte / coloraci√≥n</option><option>Peinado</option><option>Tratamiento capilar</option><option>Manicure</option><option>Pedicure</option><option>Cejas y pesta√±as</option><option>Maquillaje</option><option>Alisado</option><option>Otro</option></select></div>
    </div>
    <div class="fg2">
      <div class="fg"><label>Fecha *</label><input type="date" id="t-fe"></div>
      <div class="fg"><label>Precio (S/) *</label><input type="number" id="t-pr" placeholder="0.00" min="0" step="0.50"></div>
    </div>
    <div class="fg2 full"><div class="fg"><label>Productos usados</label><input type="text" id="t-pd" placeholder="Ej: Tinte L'Oreal N¬∞5, Oxidante 20vol‚Ä¶"></div></div>
    <div class="fg2 full"><div class="fg"><label>Observaciones / notas</label><textarea id="t-ob" placeholder="Ej: Resultado excelente, clienta satisfecha‚Ä¶"></textarea></div></div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('m-trabajo')">Cancelar</button>
      <button class="btn btn-primary" id="btn-st">üíæ Guardar</button>
    </div>
  </div>
</div>

<!-- MODAL CLIENTE -->
<div class="mo" id="m-cliente">
  <div class="modal">
    <div class="modal-title" id="mt-cl">üë© Nueva Cliente</div>
    <input type="hidden" id="cl-eid">
    <div class="fg2">
      <div class="fg"><label>Nombre completo *</label><input type="text" id="cl-nm" placeholder="Ej: Mar√≠a Garc√≠a"></div>
      <div class="fg"><label>Tel√©fono</label><input type="tel" id="cl-te" placeholder="987 654 321"></div>
    </div>
    <div class="fg2">
      <div class="fg"><label>Fecha de nacimiento</label><input type="date" id="cl-na"></div>
      <div class="fg"><label>Servicio favorito</label><select id="cl-sf"><option value="">Seleccionar‚Ä¶</option><option>Corte de cabello</option><option>Tinte / coloraci√≥n</option><option>Manicure</option><option>Pedicure</option><option>Cejas y pesta√±as</option><option>Maquillaje</option></select></div>
    </div>
    <div class="fg2 full"><div class="fg"><label>Notas / alergias</label><textarea id="cl-no" placeholder="Ej: Al√©rgica al amoniaco‚Ä¶"></textarea></div></div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('m-cliente')">Cancelar</button>
      <button class="btn btn-primary" id="btn-scl">üíæ Guardar</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
// ‚îÄ‚îÄ APPS SCRIPT CODE ‚îÄ‚îÄ
const AS_CODE = `// YENI STUDIO ‚Äî Backend
const SHEET_ID = "1VCZRmvF_QCZQAD_AL79TkLVYE1Zu0bIjbRpUjH2mwec";

function doGet(e) {
  const ws = SpreadsheetApp.openById(SHEET_ID).getSheetByName(e.parameter.tab);
  if (!ws) return res([]);
  return res(ws.getDataRange().getValues());
}

function doPost(e) {
  const b = JSON.parse(e.postData.contents);
  const sheet = SpreadsheetApp.openById(SHEET_ID);
  const ws = sheet.getSheetByName(b.tab) || sheet.insertSheet(b.tab);
  if (b.action === "append") {
    ws.appendRow(b.row);
  } else if (b.action === "update") {
    const rows = ws.getDataRange().getValues();
    for (let i = 1; i < rows.length; i++) {
      if (String(rows[i][0]) === String(b.id)) {
        b.row.forEach((v, j) => ws.getRange(i+1, j+1).setValue(v));
        break;
      }
    }
  } else if (b.action === "delete") {
    const rows = ws.getDataRange().getValues();
    for (let i = 1; i < rows.length; i++) {
      if (String(rows[i][0]) === String(b.id)) { ws.deleteRow(i+1); break; }
    }
  }
  return res({ok:true});
}

function res(data) {
  return ContentService.createTextOutput(JSON.stringify(data))
    .setMimeType(ContentService.MimeType.JSON);
}`;

document.getElementById('code-block').textContent = AS_CODE;

function toggleCode(){
  const box = document.getElementById('code-block');
  const btn = document.querySelector('.code-toggle');
  if(box.style.display === 'none' || !box.style.display){
    box.style.display = 'block';
    btn.textContent = '‚ùå Cerrar c√≥digo';
    navigator.clipboard?.writeText(AS_CODE).then(()=>toast('üìã C√≥digo copiado al portapapeles'));
  } else {
    box.style.display = 'none';
    btn.textContent = 'üìã Ver / copiar c√≥digo para Apps Script';
  }
}

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let API = '';
let D = {clientes:[],citas:[],trabajos:[]};
let cf = 'todas';

// ‚îÄ‚îÄ SETUP ‚îÄ‚îÄ
async function conectar(){
  const url = document.getElementById('api-url').value.trim();
  const err = document.getElementById('setup-error');
  err.style.display='none';
  if(!url.includes('script.google.com')){err.style.display='block';err.textContent='‚ö†Ô∏è Ingresa una URL v√°lida de Apps Script';return;}
  const btn=document.getElementById('btn-connect');
  btn.disabled=true;btn.textContent='‚è≥ Conectando‚Ä¶';
  API = url;
  try{
    await post({tab:'clientes',action:'append',row:['id','nombre','telefono','nacimiento','servicioFav','notas']});
    await post({tab:'citas',action:'append',row:['id','clienteId','clienteNombre','servicio','fecha','hora','estado','notas']});
    await post({tab:'trabajos',action:'append',row:['id','clienteId','clienteNombre','servicio','fecha','precio','productos','observaciones']});
    localStorage.setItem('ys_api',url);
    launchApp();
  }catch(e){
    err.style.display='block';err.textContent='‚ùå No se pudo conectar. Verifica la URL e intenta de nuevo.';
    btn.disabled=false;btn.textContent='üîó Conectar con Google Sheets';
  }
}

function reconfig(){if(!confirm('¬øReconfigurar?'))return;localStorage.removeItem('ys_api');location.reload();}

// ‚îÄ‚îÄ API ‚îÄ‚îÄ
async function get(tab){
  const r=await fetch(`${API}?action=read&tab=${tab}&_=${Date.now()}`);
  if(!r.ok)throw new Error('HTTP '+r.status);
  return r.json();
}
async function post(body){
  const r=await fetch(API,{method:'POST',body:JSON.stringify(body)});
  if(!r.ok)throw new Error('HTTP '+r.status);
  return r.json();
}
function uid(){return Date.now().toString(36)+Math.random().toString(36).slice(2);}
function parse(rows,keys){
  if(!rows||rows.length<2)return[];
  return rows.slice(1).filter(r=>r[0]&&r[0]!=='id').map(r=>{
    const o={};keys.forEach((k,i)=>o[k]=r[i]!==undefined?String(r[i]):'');return o;
  });
}
function zip(keys,vals){const o={};keys.forEach((k,i)=>o[k]=String(vals[i]||''));return o;}

// ‚îÄ‚îÄ SYNC ‚îÄ‚îÄ
async function syncAll(){
  const btn=document.getElementById('btn-sync');
  btn.classList.add('spinning');
  document.getElementById('sync-lbl').textContent='Sincronizando‚Ä¶';
  try{
    const [rc,rci,rt]=await Promise.all([get('clientes'),get('citas'),get('trabajos')]);
    D.clientes=parse(rc,['id','nombre','telefono','nacimiento','servicioFav','notas']);
    D.citas=parse(rci,['id','clienteId','clienteNombre','servicio','fecha','hora','estado','notas']);
    D.trabajos=parse(rt,['id','clienteId','clienteNombre','servicio','fecha','precio','productos','observaciones']);
    const n=new Date();
    document.getElementById('sync-lbl').textContent=`‚úÖ ${n.getHours()}:${String(n.getMinutes()).padStart(2,'0')}`;
    renderAll();
  }catch(e){document.getElementById('sync-lbl').textContent='‚ùå Error de conexi√≥n';}
  btn.classList.remove('spinning');
}

function renderAll(){renderDash();renderCitas();renderTrabajos();renderClientes();renderAlertas();}

// ‚îÄ‚îÄ NAV ‚îÄ‚îÄ
const titles={dashboard:'Dashboard',citas:'Citas',trabajos:'Trabajos',clientes:'Clientes',alertas:'Alertas'};
function goPage(id,el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  if(el)el.classList.add('active');
  document.getElementById('page-title').textContent=titles[id]||id;
  closeSidebar();
}
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('overlay').classList.toggle('open');}
function closeSidebar(){document.getElementById('sidebar').classList.remove('open');document.getElementById('overlay').classList.remove('open');}

// ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ
function openModal(id){
  if(id==='m-cita'||id==='m-trabajo')fillSel(id==='m-cita'?'c-cl':'t-cl');
  document.getElementById(id).classList.add('open');
}
function closeModal(id){
  document.getElementById(id).classList.remove('open');
  if(id==='m-cita')rCita();if(id==='m-trabajo')rTrab();if(id==='m-cliente')rCl();
}
document.querySelectorAll('.mo').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('open');}));
function fillSel(id){
  const s=document.getElementById(id),cur=s.value;
  s.innerHTML='<option value="">Seleccionar cliente‚Ä¶</option>';
  D.clientes.forEach(c=>{const o=document.createElement('option');o.value=c.id;o.textContent=c.nombre;if(c.id===cur)o.selected=true;s.appendChild(o);});
}
function hoy(){return new Date().toISOString().split('T')[0];}

// ‚îÄ‚îÄ CITAS ‚îÄ‚îÄ
function rCita(){
  ['c-eid','c-no'].forEach(i=>document.getElementById(i).value='');
  ['c-cl','c-sv'].forEach(i=>document.getElementById(i).selectedIndex=0);
  document.getElementById('c-es').value='pendiente';
  document.getElementById('c-fe').value=hoy();
  document.getElementById('c-ho').value='';
  document.getElementById('mt-cita').textContent='üìÖ Nueva Cita';
}

document.getElementById('btn-sc').onclick=async function(){
  const cId=document.getElementById('c-cl').value,sv=document.getElementById('c-sv').value,
        fe=document.getElementById('c-fe').value,ho=document.getElementById('c-ho').value;
  if(!cId||!sv||!fe||!ho){toast('‚ö†Ô∏è Completa los campos requeridos');return;}
  const eid=document.getElementById('c-eid').value;
  const cNm=D.clientes.find(c=>c.id===cId)?.nombre||'';
  const keys=['id','clienteId','clienteNombre','servicio','fecha','hora','estado','notas'];
  const row=[eid||uid(),cId,cNm,sv,fe,ho,document.getElementById('c-es').value,document.getElementById('c-no').value];
  try{
    if(eid){await post({tab:'citas',action:'update',id:eid,row});const i=D.citas.findIndex(c=>c.id===eid);D.citas[i]=zip(keys,row);}
    else{await post({tab:'citas',action:'append',row});D.citas.push(zip(keys,row));}
    toast('‚úÖ Cita guardada en Google Sheets');closeModal('m-cita');renderCitas();renderDash();renderAlertas();
  }catch(e){toast('‚ùå Error: '+e.message);}
};

function editCita(id){
  const c=D.citas.find(x=>x.id===id);if(!c)return;
  fillSel('c-cl');
  document.getElementById('c-eid').value=c.id;document.getElementById('c-cl').value=c.clienteId;
  document.getElementById('c-sv').value=c.servicio;document.getElementById('c-fe').value=c.fecha;
  document.getElementById('c-ho').value=c.hora;document.getElementById('c-es').value=c.estado;
  document.getElementById('c-no').value=c.notas||'';document.getElementById('mt-cita').textContent='‚úèÔ∏è Editar Cita';
  openModal('m-cita');
}

async function cState(id,estado){
  const c=D.citas.find(x=>x.id===id);if(!c)return;c.estado=estado;
  const row=[c.id,c.clienteId,c.clienteNombre,c.servicio,c.fecha,c.hora,estado,c.notas];
  try{await post({tab:'citas',action:'update',id,row});toast('‚úÖ Estado actualizado');renderCitas();renderDash();}
  catch(e){toast('‚ùå '+e.message);}
}

async function delCita(id){
  if(!confirm('¬øEliminar cita?'))return;
  try{await post({tab:'citas',action:'delete',id});D.citas=D.citas.filter(c=>c.id!==id);toast('üóë Eliminada');renderCitas();renderDash();}
  catch(e){toast('‚ùå '+e.message);}
}

function fCita(f,el){cf=f;document.querySelectorAll('#page-citas .chip').forEach(c=>c.classList.remove('active'));el.classList.add('active');renderCitas();}

function renderCitas(){
  let list=[...D.citas];if(cf!=='todas')list=list.filter(c=>c.estado===cf);
  list.sort((a,b)=>(b.fecha+b.hora).localeCompare(a.fecha+a.hora));
  const tb=document.getElementById('t-citas');
  if(!list.length){tb.innerHTML=`<tr class="er"><td colspan="7">Sin citas</td></tr>`;return;}
  tb.innerHTML=list.map(c=>`<tr>
    <td><b>${c.clienteNombre||'‚Äî'}</b></td><td>${c.servicio}</td>
    <td>${fd(c.fecha)}</td><td>${fh(c.hora)}</td>
    <td><span class="badge ${bc(c.estado)}">${bt(c.estado)}</span></td>
    <td style="max-width:110px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${c.notas||'‚Äî'}</td>
    <td><div class="tda">
      ${c.estado==='pendiente'?`<button class="btn btn-sm btn-success" onclick="cState('${c.id}','confirmada')">‚úî</button>`:''}
      ${c.estado==='confirmada'?`<button class="btn btn-sm btn-warn" onclick="cState('${c.id}','completada')">‚úì</button>`:''}
      ${c.estado!=='cancelada'&&c.estado!=='completada'?`<button class="btn btn-sm btn-danger" onclick="cState('${c.id}','cancelada')">‚úï</button>`:''}
      <button class="btn btn-sm btn-ghost" onclick="editCita('${c.id}')">‚úèÔ∏è</button>
      <button class="btn btn-sm btn-danger" onclick="delCita('${c.id}')">üóë</button>
    </div></td>
  </tr>`).join('');
}

// ‚îÄ‚îÄ TRABAJOS ‚îÄ‚îÄ
function rTrab(){
  ['t-eid','t-pd','t-ob'].forEach(i=>document.getElementById(i).value='');
  ['t-cl','t-sv'].forEach(i=>document.getElementById(i).selectedIndex=0);
  document.getElementById('t-fe').value=hoy();document.getElementById('t-pr').value='';
  document.getElementById('mt-tr').textContent='üíÖ Registrar Trabajo';
}

document.getElementById('btn-st').onclick=async function(){
  const cId=document.getElementById('t-cl').value,sv=document.getElementById('t-sv').value,
        fe=document.getElementById('t-fe').value,pr=document.getElementById('t-pr').value;
  if(!cId||!sv||!fe||!pr){toast('‚ö†Ô∏è Completa los campos requeridos');return;}
  const eid=document.getElementById('t-eid').value;
  const cNm=D.clientes.find(c=>c.id===cId)?.nombre||'';
  const keys=['id','clienteId','clienteNombre','servicio','fecha','precio','productos','observaciones'];
  const row=[eid||uid(),cId,cNm,sv,fe,pr,document.getElementById('t-pd').value,document.getElementById('t-ob').value];
  try{
    if(eid){await post({tab:'trabajos',action:'update',id:eid,row});const i=D.trabajos.findIndex(t=>t.id===eid);D.trabajos[i]=zip(keys,row);}
    else{await post({tab:'trabajos',action:'append',row});D.trabajos.push(zip(keys,row));}
    toast('‚úÖ Trabajo guardado en Google Sheets');closeModal('m-trabajo');renderTrabajos();renderDash();
  }catch(e){toast('‚ùå Error: '+e.message);}
};

function editTrabajo(id){
  const t=D.trabajos.find(x=>x.id===id);if(!t)return;
  fillSel('t-cl');document.getElementById('t-eid').value=t.id;document.getElementById('t-cl').value=t.clienteId;
  document.getElementById('t-sv').value=t.servicio;document.getElementById('t-fe').value=t.fecha;
  document.getElementById('t-pr').value=t.precio;document.getElementById('t-pd').value=t.productos||'';
  document.getElementById('t-ob').value=t.observaciones||'';document.getElementById('mt-tr').textContent='‚úèÔ∏è Editar Trabajo';
  openModal('m-trabajo');
}

async function delTrabajo(id){
  if(!confirm('¬øEliminar trabajo?'))return;
  try{await post({tab:'trabajos',action:'delete',id});D.trabajos=D.trabajos.filter(t=>t.id!==id);toast('üóë Eliminado');renderTrabajos();renderDash();}
  catch(e){toast('‚ùå '+e.message);}
}

function renderTrabajos(){
  const list=[...D.trabajos].sort((a,b)=>b.fecha.localeCompare(a.fecha));
  const tb=document.getElementById('t-trabajos');
  if(!list.length){tb.innerHTML=`<tr class="er"><td colspan="7">Sin trabajos registrados</td></tr>`;return;}
  tb.innerHTML=list.map(t=>`<tr>
    <td><b>${t.clienteNombre||'‚Äî'}</b></td><td>${t.servicio}</td>
    <td>${fd(t.fecha)}</td><td style="color:var(--green);font-weight:600">S/ ${parseFloat(t.precio||0).toFixed(2)}</td>
    <td style="max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${t.productos||'‚Äî'}</td>
    <td style="max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${t.observaciones||'‚Äî'}</td>
    <td><div class="tda">
      <button class="btn btn-sm btn-ghost" onclick="editTrabajo('${t.id}')">‚úèÔ∏è</button>
      <button class="btn btn-sm btn-danger" onclick="delTrabajo('${t.id}')">üóë</button>
    </div></td>
  </tr>`).join('');
}

// ‚îÄ‚îÄ CLIENTES ‚îÄ‚îÄ
function rCl(){
  ['cl-eid','cl-nm','cl-te','cl-no'].forEach(i=>document.getElementById(i).value='');
  document.getElementById('cl-na').value='';document.getElementById('cl-sf').selectedIndex=0;
  document.getElementById('mt-cl').textContent='üë© Nueva Cliente';
}

document.getElementById('btn-scl').onclick=async function(){
  const nm=document.getElementById('cl-nm').value.trim();
  if(!nm){toast('‚ö†Ô∏è Ingresa el nombre');return;}
  const eid=document.getElementById('cl-eid').value;
  const keys=['id','nombre','telefono','nacimiento','servicioFav','notas'];
  const row=[eid||uid(),nm,document.getElementById('cl-te').value.trim(),document.getElementById('cl-na').value,document.getElementById('cl-sf').value,document.getElementById('cl-no').value.trim()];
  try{
    if(eid){await post({tab:'clientes',action:'update',id:eid,row});const i=D.clientes.findIndex(c=>c.id===eid);D.clientes[i]=zip(keys,row);}
    else{await post({tab:'clientes',action:'append',row});D.clientes.push(zip(keys,row));}
    toast('‚úÖ Cliente guardada en Google Sheets');closeModal('m-cliente');renderClientes();renderDash();
  }catch(e){toast('‚ùå Error: '+e.message);}
};

function editCliente(id){
  const c=D.clientes.find(x=>x.id===id);if(!c)return;
  document.getElementById('cl-eid').value=c.id;document.getElementById('cl-nm').value=c.nombre;
  document.getElementById('cl-te').value=c.telefono||'';document.getElementById('cl-na').value=c.nacimiento||'';
  document.getElementById('cl-sf').value=c.servicioFav||'';document.getElementById('cl-no').value=c.notas||'';
  document.getElementById('mt-cl').textContent='‚úèÔ∏è Editar Cliente';openModal('m-cliente');
}

async function delCliente(id){
  if(!confirm('¬øEliminar cliente?'))return;
  try{await post({tab:'clientes',action:'delete',id});D.clientes=D.clientes.filter(c=>c.id!==id);toast('üóë Eliminada');renderClientes();renderDash();}
  catch(e){toast('‚ùå '+e.message);}
}

function renderClientes(){
  const q=document.getElementById('s-cl-q').value.toLowerCase();
  let list=q?D.clientes.filter(c=>c.nombre.toLowerCase().includes(q)||(c.telefono||'').includes(q)):[...D.clientes];
  list.sort((a,b)=>a.nombre.localeCompare(b.nombre));
  const tb=document.getElementById('t-clientes');
  if(!list.length){tb.innerHTML=`<tr class="er"><td colspan="6">${q?'Sin resultados':'Sin clientes registradas'}</td></tr>`;return;}
  tb.innerHTML=list.map(c=>{
    const nc=D.citas.filter(ci=>ci.clienteId===c.id).length;
    return `<tr><td><b>${c.nombre}</b></td><td>${c.telefono||'‚Äî'}</td><td>${c.servicioFav||'‚Äî'}</td>
    <td>${nc} cita${nc!==1?'s':''}</td>
    <td style="max-width:130px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${c.notas||'‚Äî'}</td>
    <td><div class="tda"><button class="btn btn-sm btn-ghost" onclick="editCliente('${c.id}')">‚úèÔ∏è</button><button class="btn btn-sm btn-danger" onclick="delCliente('${c.id}')">üóë</button></div></td></tr>`;
  }).join('');
}

// ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ
function renderDash(){
  const todayStr=hoy();
  const citasHoy=D.citas.filter(c=>c.fecha===todayStr&&c.estado!=='cancelada');
  const now=new Date();
  const ingMes=D.trabajos.reduce((s,t)=>{
    const d=new Date(t.fecha+'T12:00');
    return d.getFullYear()===now.getFullYear()&&d.getMonth()===now.getMonth()?s+parseFloat(t.precio||0):s;
  },0);
  document.getElementById('s-hoy').textContent=citasHoy.length;
  document.getElementById('s-cl').textContent=D.clientes.length;
  document.getElementById('s-tr').textContent=D.trabajos.length;
  document.getElementById('s-ing').textContent='S/'+ingMes.toFixed(0);
  const tb=document.getElementById('t-hoy');
  if(!citasHoy.length){tb.innerHTML=`<tr class="er"><td colspan="4">Sin citas para hoy üå∏</td></tr>`;return;}
  tb.innerHTML=citasHoy.sort((a,b)=>a.hora.localeCompare(b.hora)).map(c=>`<tr>
    <td><b>${c.clienteNombre}</b></td><td>${c.servicio}</td>
    <td>${fh(c.hora)}</td><td><span class="badge ${bc(c.estado)}">${bt(c.estado)}</span></td>
  </tr>`).join('');
  // Alert banner
  const man=new Date();man.setDate(man.getDate()+1);
  const alertas=D.citas.filter(c=>c.fecha===man.toISOString().split('T')[0]&&c.estado!=='cancelada');
  const banner=document.getElementById('alert-banner');
  const badge=document.getElementById('badge-n');
  if(alertas.length){
    banner.style.display='block';badge.style.display='inline';badge.textContent=alertas.length;
    document.getElementById('ab-list').innerHTML=alertas.sort((a,b)=>a.hora.localeCompare(b.hora))
      .map(a=>`<div class="ab-row">‚è∞ <b>${fh(a.hora)}</b> ‚Äî ${a.clienteNombre} ¬∑ ${a.servicio}</div>`).join('');
  }else{banner.style.display='none';badge.style.display='none';}
}

function renderAlertas(){
  const man=new Date();man.setDate(man.getDate()+1);
  const alertas=D.citas.filter(c=>c.fecha===man.toISOString().split('T')[0]&&c.estado!=='cancelada').sort((a,b)=>a.hora.localeCompare(b.hora));
  const tb=document.getElementById('t-alertas');
  if(!alertas.length){tb.innerHTML=`<tr class="er"><td colspan="6">Sin citas para ma√±ana üéâ</td></tr>`;return;}
  tb.innerHTML=alertas.map(a=>`<tr><td>üîî</td><td><b>${a.clienteNombre}</b></td><td>${a.servicio}</td><td>${fd(a.fecha)}</td><td>${fh(a.hora)}</td><td><span class="badge ${bc(a.estado)}">${bt(a.estado)}</span></td></tr>`).join('');
}

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
function fd(d){if(!d||d==='fecha')return'‚Äî';const[y,m,dy]=d.split('-');return`${dy}/${m}/${y}`;}
function fh(h){if(!h||h==='hora')return'‚Äî';const[hh,mm]=h.split(':'),hr=parseInt(hh);return`${hr>12?hr-12:hr}:${mm} ${hr>=12?'PM':'AM'}`;}
const bc=e=>({pendiente:'b-pend',confirmada:'b-conf',completada:'b-done',cancelada:'b-canc'}[e]||'b-pend');
const bt=e=>({pendiente:'Pendiente',confirmada:'Confirmada',completada:'Completada',cancelada:'Cancelada'}[e]||e);
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2800);}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
function launchApp(){
  document.getElementById('setup').style.display='none';
  document.getElementById('app').style.display='block';
  if('Notification' in window && Notification.permission==='default') Notification.requestPermission();
  syncAll();
  setInterval(syncAll,60000);
}

const saved=localStorage.getItem('ys_api');
if(saved){API=saved;launchApp();}
</script>
</body>
</html>
